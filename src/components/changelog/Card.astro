---
export const prerender = false;

import { marked } from 'marked';
import { changelogs, type ChangelogProps } from '@/src/libs/datum';

const entries = await changelogs();
---

{
  entries.length > 100 ? (
    Array.prototype.map.call(entries, (entry: ChangelogProps) => () => (
      <div class="changelog-item">
        <div class="changelog-item--timeline">
          <div class="changelog-item--timeline-dot">
            <svg
              width="19"
              height="19"
              viewBox="0 0 19 19"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <circle cx="9.5" cy="9.5" r="5.5" fill="#E6F59F" />
              <circle opacity="0.3" cx="9.5" cy="9.5" r="9.5" fill="#E6F59F" />
            </svg>
          </div>
          <div class="changelog-item--timeline-line" />
        </div>

        <div class="changelog-item--content">
          <div class="changelog-item--date">
            {new Date(entry.createdAt).toLocaleDateString('en-US', {
              day: 'numeric',
              month: 'long',
              year: 'numeric',
            })}
          </div>

          <div class="changelog-item--main">
            <h3 class="changelog-item--title">{entry.title}</h3>
            <div class="changelog-item--description" set:html={marked.parse(entry.body)} />

            <div class="changelog-item--tags">
              {entry.labels?.nodes.map((label) => (
                <div class="changelog-item--tag-group">
                  <span
                    class={`changelog-item--tag changelog-item--tag--${label.name.toLowerCase()}`}
                  >
                    {label.name}
                  </span>
                  {label.description && (
                    <span class="changelog-item--tag-description">{label.description}</span>
                  )}
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    ))
  ) : (
    <div class="fade-in--pure fade-in--pure--visible z-50 mx-auto flex flex-col items-center space-y-10 text-center md:max-w-124">
      <div class="datum-text-2xl md:max-w-sm">No changelog entries found.</div>
    </div>
  )
}
