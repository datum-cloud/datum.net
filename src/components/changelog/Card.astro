---
export const prerender = false;

import { marked } from 'marked';
import Icon from '@components/Icon.astro';
import { changelogs, type ChangelogProps } from '@/src/libs/datum';

const entries = await changelogs();
---

<div class="changelog-list">
  {
    entries.map((entry: ChangelogProps, index: number) => (
      <div
        id={`changelog-${entry.id}`}
        class:list={['changelog-entry', { 'changelog-entry--last': index === entries.length - 1 }]}
      >
        <div class="changelog-entry-sidebar">
          <div class="changelog-entry-timeline">
            <div class="changelog-entry-dot">
              <Icon name="radar" size="lg" />
            </div>
            <div class="changelog-entry-line" />
          </div>
          <div class="changelog-entry-nav">
            <h3 class="changelog-entry-nav-title">{entry.title}</h3>
            <time class="changelog-entry-nav-date">
              {new Date(entry.createdAt).toLocaleDateString('en-US', {
                day: 'numeric',
                month: 'long',
                year: 'numeric',
              })}
            </time>
          </div>
        </div>

        <article class="changelog-entry-card">
          <header class="changelog-entry-card-header">
            <h2 class="changelog-entry-card-title">Summary</h2>
            <a
              href={entry.url}
              target="_blank"
              rel="noopener noreferrer"
              class="changelog-entry-card-link"
            >
              <span>View on GitHub</span>
              <Icon name="external-link" size="md" />
            </a>
          </header>

          <div class="changelog-entry-card-body" set:html={marked.parse(entry.body)} />

          {entry.labels && entry.labels.nodes.length > 0 && (
            <div class="changelog-entry-card-tags">
              {entry.labels.nodes.map((label) => (
                <div class="changelog-entry-card-tag-row">
                  <span
                    class={`changelog-entry-card-tag changelog-entry-card-tag--${label.name.toLowerCase()}`}
                  >
                    {label.name}
                  </span>
                  {label.description && (
                    <span class="changelog-entry-card-tag-description">{label.description}</span>
                  )}
                </div>
              ))}
            </div>
          )}
        </article>
      </div>
    ))
  }
</div>
