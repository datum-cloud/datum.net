---
// src/components/handbook/PageNav.astro
import ArticleNavigation from '@components/ArticleNavigation.astro';
import LastUpdated from '@components/handbook/LastUpdated.astro';
import type { SidebarItems } from '@/src/types/common';

const {
  currentArticleId,
  items,
  lastUpdated,
  class: className,
} = Astro.props as {
  currentArticleId: string;
  class?: string;
  items: SidebarItems[];
  lastUpdated?: Date;
};

const handbookItems: Array<{ id: string; data: { title: string } }> = [];

Object.values(items).forEach((item: SidebarItems) => {
  item.childs?.forEach((child: { slug: string; label: string; title?: string }) => {
    handbookItems.push({
      id: child.slug,
      data: {
        title: child.title || child.label,
      },
    });
  });
});

// Find current article index for navigation
const currentIndex = handbookItems.findIndex((h) => h.id === currentArticleId);
const previousArticle = currentIndex > 0 ? handbookItems[currentIndex - 1] : undefined;
const nextArticle =
  currentIndex < handbookItems.length - 1 ? handbookItems[currentIndex + 1] : undefined;
---

{/* Last Updated */}
<footer id="footer-article" class="article-footer">
  {lastUpdated && <LastUpdated date={lastUpdated} />}

  <ArticleNavigation
    previousArticle={previousArticle
      ? {
          id: previousArticle.id,
          title: previousArticle.data.title,
          url: `/handbook/${previousArticle.id}/`,
        }
      : undefined}
    nextArticle={nextArticle
      ? {
          id: nextArticle.id,
          title: nextArticle.data.title,
          url: `/handbook/${nextArticle.id}/`,
        }
      : undefined}
    class={className}
  />
</footer>
