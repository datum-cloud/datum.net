---
import type { SidebarProps } from '@/src/types/common';

const { selectedId, items } = Astro.props as SidebarProps;
---

<aside class:list={['handbook-sidebar']}>
  <nav
    class="fade-in--pure"
    data-reveal="fade-in--pure--visible"
    data-reveal-immediate="true"
    data-reveal-delay="100"
  >
    <div data-state="open" data-orientation="vertical" class="menu-container" id="menu">
      {
        Object.values(items).map(
          (item: { slug: string; label: string; childs?: { slug: string; label: string }[] }) => {
            if (item) {
              console.log(item);
              return (
                <div
                  x-data={`{ isExpanded: ${selectedId === item.slug} }`}
                  class="menu-category"
                  id={item.slug}
                >
                  <div class="category-header">
                    <button
                      type="button"
                      class="category-button"
                      x-on:click="isExpanded = ! isExpanded"
                    >
                      <div class="category-title-container">
                        <span
                          class={
                            item.slug == selectedId
                              ? 'category-title category-title--active'
                              : 'category-title'
                          }
                        >
                          {item.label}
                        </span>
                      </div>

                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="chevron-icon"
                        aria-hidden="true"
                        x-bind:class="isExpanded ? 'rotate-90' : ''"
                      >
                        <path d="m9 18 6-6-6-6" />
                      </svg>
                    </button>
                  </div>

                  <ul x-show="isExpanded" x-collapse class="menu-list">
                    {item.childs &&
                      item.childs.map((child) => {
                        console.log(child);
                        return (
                          <li class="menu-item">
                            <a
                              href={`/handbook/${child.slug.endsWith('/') ? child.slug : child.slug + '/'}`}
                              class={
                                child.slug == selectedId
                                  ? 'menu-link menu-link--active'
                                  : 'menu-link'
                              }
                            >
                              {child.label}{' '}
                            </a>
                          </li>
                        );
                      })}
                  </ul>
                </div>
              );
            }
          }
        )
      }
    </div>
  </nav>
</aside>
