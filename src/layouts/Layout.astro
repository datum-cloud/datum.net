---
import { SEO } from 'astro-seo';
import '@v1/styles/global.css';
import config from '@data/siteConfig.json';
import { formatISODate } from '@utils/dateUtils';
import type { LayoutProps } from '@/src/types/common';

const {
  title,
  description,
  image,
  article,
  publishDate,
  author,
  canonical,
  dataTheme = '',
  bodyClass = 'template',
} = Astro.props as LayoutProps;

const pageUrl = Astro.url.href;
const defaultImage = new URL('/images/default-og.jpg', Astro.site).href;
const imageUrl = image ? new URL(image, Astro.site).href : defaultImage;
---

<!doctype html>
<html lang="en" data-theme={dataTheme}>
  <head>
    <SEO
      title={title}
      description={description}
      canonical={canonical || pageUrl}
      noindex={true}
      nofollow={true}
      openGraph={{
        basic: {
          title: title,
          type: article ? 'article' : 'website',
          image: imageUrl,
          url: canonical || pageUrl,
        },
        optional: {
          description: description,
          siteName: 'Datum Inc. Site',
          locale: 'en_US',
        },
        ...(article && publishDate
          ? {
              article: {
                publishedTime: formatISODate(publishDate),
                authors: [author || 'Datum Inc.'],
              },
            }
          : {}),
      }}
      twitter={{
        card: 'summary_large_image',
        site: config.socials.twitter.handle || '@datumcloud',
        creator: config.socials.twitter.handle || '@datumcloud',
        title: title,
        description: description,
        image: imageUrl,
      }}
      extend={{
        meta: [
          { name: 'twitter:url', content: canonical || pageUrl },
          { name: 'theme-color', content: '#3b82f6' },
        ],
        link: [
          { rel: 'icon', href: '/favicon.png' },
          { rel: 'mask-icon', href: '/favicon.svg' },
          { rel: 'apple-touch-icon', href: '/apple-touch-icon.png' },
        ],
      }}
    />
    <link rel="sitemap" href="/sitemap-index.xml" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.png" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Montserrat:wght@700;800&display=swap"
      rel="stylesheet"
    />

    <script>
      // eslint-disable-next-line @typescript-eslint/ban-ts-comment
      // @ts-nocheck
      /* eslint-disable */
      window.markerConfig = { project: '6740d085b5f507690e9a2c19', source: 'snippet' };
      !(function (e, r, a) {
        if (!e.__Marker) {
          e.__Marker = {};
          var t = [],
            n = { __cs: t };
          ([
            'show',
            'hide',
            'isVisible',
            'capture',
            'cancelCapture',
            'unload',
            'reload',
            'isExtensionInstalled',
            'setReporter',
            'clearReporter',
            'setCustomData',
            'on',
            'off',
          ].forEach(function (e) {
            n[e] = function () {
              var r = Array.prototype.slice.call(arguments);
              (r.unshift(e), t.push(r));
            };
          }),
            (e.Marker = n));
          var s = r.createElement('script');
          ((s.async = 1), (s.src = 'https://edge.marker.io/latest/shim.js'));
          var i = r.getElementsByTagName('script')[0];
          i.parentNode.insertBefore(s, i);
        }
      })(window, document);
      /* eslint-enable */
      // @ts-check
    </script>
  </head>
  <body class={bodyClass}>
    <slot />

    <script>
      import '/src/v1/scripts/lenis-parallax.js';
    </script>
  </body>
</html>
