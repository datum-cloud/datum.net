---
import '@v1/styles/page-brand.css';
import Layout from '@layouts/LayoutSimple.astro';
import Footer from '@components/Footer.astro';
import Hero from '@components/Hero.astro';
import NavBrand from '@components/brand/NavBrand.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  // Get all brand pages
  const brandPages = await getCollection('pages', ({ id }) => {
    return id.startsWith('brand/') && id !== 'brand/index';
  });

  // Create paths for each brand page
  const paths = brandPages.map((page) => {
    // Remove 'brand/' prefix to get the slug
    const slug = page.id.replace('brand/', '');
    return {
      params: { slug },
      props: { page },
    };
  });

  return paths;
}

const { page } = Astro.props;

const { Content } = await render(page);
const fm = page.data;
const meta = fm.meta || {};
const title = fm.title ? fm.title : 'Our visual identity';
const subtitle = fm.subtitle ? fm.subtitle : 'Design Assets';
const icon = fm.iconName ? fm.iconName : 'image';

// Get current path for active navigation state
const currentPath = Astro.url.pathname;
---

<Layout
  title={fm.title}
  description={fm.description}
  bodyClass={`page-brand page-brand--${page.id}`}
  meta={meta}
>
  <section class="datum-container">
    <Hero class="light" iconName={icon} title={title} subtitle={subtitle} />
    <div class="section--block bg-glacier-mist-700">
      <div class="max-width m-auto grid grid-cols-1 md:grid-cols-12 md:gap-10 lg:gap-12">
        <sidebar class="brand-sidebar">
          <NavBrand currentPath={currentPath} />
        </sidebar>
        <div class="brand-wrapper">
          <article class="brand-article">
            <div class="brand-article--content">
              <Content />
            </div>
          </article>
        </div>
      </div>
    </div>
    <Footer showCTA={false} />
  </section>
</Layout>
