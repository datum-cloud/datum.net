---
// src/pages/careers/[slug].astro
import '@v1/styles/page-blog.css';
import Layout from '@layouts/Layout.astro';
import Hero from '@components/Hero.astro';
import Footer from '@components/Footer.astro';
import Button from '@components/Button.astro';
import { getCollection, render } from 'astro:content';
import { formatShortDate } from '@utils/dateUtils';
import Icon from '@components/Icon.astro';
import defaultOgImage from '@content/images/og/default.png';

export async function getStaticPaths() {
  const careerEntries = await getCollection('career');

  return careerEntries
    .filter((entry) => !entry.data.draft)
    .map((entry) => {
      return {
        params: { slug: entry.id },
        props: { entry },
      };
    });
}

const { entry } = Astro.props;
const { Content } = await render(entry);
const formattedDate = entry.data.date ? formatShortDate(entry.data.date) : '';

// SEO
const fm = entry.data;
const meta = fm.meta || {};
const title = fm.title;
const description = fm.description ? fm.description : '';

// Set default career OG image
const careerMeta = {
  ...meta,
  og: {
    image: defaultOgImage,
    ...meta?.og,
  },
};
---

<Layout
  title={title}
  description={description}
  bodyClass={`page-careers page-careers--${entry.id}`}
  meta={careerMeta}
>
  <section class="datum-container">
    <Hero class="light" hideContent={true} />

    <section class="bg-glacier-mist-700 section--block pt-6 md:pt-10 xl:pt-16">
      <div class="max-width blog-detail max-w-256.5">
        <aside class="blog-aside">
          <div class="blog-aside-content sticky top-0">
            <Button
              class="btn btn--alpha btn--fluid mb-11"
              text="Back to Careers"
              icon={{ name: 'arrow-left', size: 'md' }}
              iconPosition="left"
              iconClass="stroke-1.5"
              href="/careers/"
            />

            {
              fm.location && (
                <span class="icon-label">
                  <div class="icon-bg">
                    <Icon name="map-pin-house" size="sm" />
                  </div>
                  <span class="icon-label-text">{fm.location}</span>
                </span>
              )
            }

            {
              fm.department && (
                <span class="icon-label">
                  <div class="icon-bg">
                    <Icon name="users" size="sm" />
                  </div>
                  <span class="icon-label-text">{fm.department}</span>
                </span>
              )
            }

            {
              fm.type && (
                <span class="icon-label">
                  <div class="icon-bg">
                    <Icon name="clock-fading" size="sm" />
                  </div>
                  <span class="icon-label-text">{fm.type}</span>
                </span>
              )
            }

            {
              formattedDate && (
                <span class="icon-label">
                  <div class="icon-bg">
                    <Icon name="calendar" size="sm" />
                  </div>
                  <span class="icon-label-text">{formattedDate}</span>
                </span>
              )
            }

            {
              fm.url && (
                <Button
                  class="btn btn--canyon-clay---links btn--fluid mt-8"
                  text="Apply Now"
                  href={fm.url}
                  target="_blank"
                />
              )
            }

            <div class="career-sidebar-footer mt-8">
              <p class="career-equal-opportunity">
                We are an equal opportunity employer committed to diversity and inclusion. All
                qualified applicants will receive consideration for employment without regard to
                race, color, religion, gender, gender identity, sexual orientation, national origin,
                disability, or veteran status.
              </p>
            </div>
          </div>
        </aside>

        <article class="blog-article">
          <!-- Article Header -->
          <header class="blog-article-header">
            <h1 class="blog-article-title">{fm.title}</h1>
            <div class="career-article-meta block md:hidden">
              {fm.location && <span class="career-meta-item">{fm.location}</span>}
              {fm.department && <span class="career-meta-item">{fm.department}</span>}
              {fm.type && <span class="career-meta-item">{fm.type}</span>}
            </div>
          </header>

          <!-- Position Overview -->
          {
            fm.overview && (
              <section class="career-section">
                <h2 class="career-section--title">Position Overview</h2>
                <div class="career-section--content">
                  <p>{fm.overview}</p>
                </div>
              </section>
            )
          }

          <!-- Key Responsibilities -->
          {
            fm.resposibilities && fm.resposibilities.length > 0 && (
              <section class="career-section">
                <h2 class="career-section--title">Key Responsibilities</h2>
                <div class="career-section--content">
                  {fm.resposibilities.map((responsibility) => (
                    <div class="career-responsibility-group">
                      {responsibility.title && (
                        <h3 class="career-responsibility-group--title">{responsibility.title}</h3>
                      )}
                      <ul class="career-list">
                        {responsibility.items.map((item) => (
                          <li class="career-list-item">{item}</li>
                        ))}
                      </ul>
                    </div>
                  ))}
                </div>
              </section>
            )
          }

          <!-- Summary Buckets -->
          {
            fm.summary && fm.summary.length > 0 && (
              <section class="career-section">
                {fm.summary.map((bucket) => (
                  <div class="career-bucket">
                    <h2 class="career-section--title">{bucket.title}</h2>
                    <ul class="career-list">
                      {bucket.items.map((item) => (
                        <li class="career-list-item">{item}</li>
                      ))}
                    </ul>
                  </div>
                ))}
              </section>
            )
          }

          <!-- Article Content (MDX/MD body) -->
          {
            entry.body && (
              <div class="blog-article-content">
                <Content />
              </div>
            )
          }

          <!-- Qualifications -->
          {
            fm.qualifications && fm.qualifications.length > 0 && (
              <section class="career-section">
                <h2 class="career-section--title">You should apply if you</h2>
                <ul class="career-list">
                  {fm.qualifications.map((qualification) => (
                    <li class="career-list-item">{qualification}</li>
                  ))}
                </ul>
              </section>
            )
          }

          <!-- Benefits -->
          {
            fm.benefits && fm.benefits.length > 0 && (
              <section class="career-section">
                <h2 class="career-section--title">What we offer</h2>
                <ul class="career-list">
                  {fm.benefits.map((benefit) => (
                    <li class="career-list-item">
                      {benefit.label}
                      {benefit.value && <span class="career-benefit-value">: {benefit.value}</span>}
                    </li>
                  ))}
                </ul>
              </section>
            )
          }
        </article>
      </div>

      <Footer />
    </section>
  </section>
</Layout>
