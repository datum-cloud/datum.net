---
import Layout from '@layouts/Layout.astro';
import { getCollection } from 'astro:content';

// Get all documentation collections
const tutorials = await getCollection('docs', (entry) => entry.id.startsWith('tutorials/'));
const tasks = await getCollection('docs', (entry) => entry.id.startsWith('tasks/'));
const api = await getCollection('docs', (entry) => entry.id.startsWith('api/'));

// Sort by weight if available
// @ts-expect-error - Astro's type definitions are incomplete
const sortByWeight = (a, b) => (a.data.weight || 999) - (b.data.weight || 999);
tutorials.sort(sortByWeight);
tasks.sort(sortByWeight);
api.sort(sortByWeight);
---

<Layout
  title="Documentation | Datum"
  description="Comprehensive documentation for Datum Cloud Network Solutions. Learn how to use our platform, follow tutorials, and explore our API."
>
  <div class="mx-auto max-w-4xl">
    <h1 class="mb-8 text-4xl font-bold">Documentation</h1>

    <div class="mb-12">
      <p class="mb-6 text-lg text-gray-700">
        Welcome to the Datum documentation. Here you'll find comprehensive guides and documentation
        to help you start working with Datum as quickly as possible.
      </p>

      <div class="grid gap-6 md:grid-cols-2">
        <div class="rounded-lg border border-gray-200 bg-white p-6">
          <h2 class="mb-4 text-2xl font-bold">Getting Started</h2>
          <p class="mb-4 text-gray-700">New to Datum? Start here to learn the basics.</p>
          <a href="/docs/get-started" class="text-blue-600 hover:underline">Get Started →</a>
        </div>

        <div class="rounded-lg border border-gray-200 bg-white p-6">
          <h2 class="mb-4 text-2xl font-bold">API Reference</h2>
          <p class="mb-4 text-gray-700">Explore our API documentation and endpoints.</p>
          <a href="/docs/api" class="text-blue-600 hover:underline">API Docs →</a>
        </div>
      </div>

      <div class="mt-6">
        <div class="grid gap-6 md:grid-cols-3">
          <div class="rounded-lg border border-gray-200 bg-white p-6">
            <h3 class="mb-3 text-xl font-bold">Tutorials</h3>
            <ul class="list-inside list-disc space-y-2">
              {
                tutorials.slice(0, 5).map((tutorial) => (
                  <li>
                    <a href={`/docs/${tutorial.id}`} class="text-blue-600 hover:underline">
                      {tutorial.data.title}
                    </a>
                  </li>
                ))
              }
            </ul>
            <a href="/docs/tutorials" class="mt-4 inline-block text-blue-600 hover:underline"
              >View all tutorials →</a
            >
          </div>

          <div class="rounded-lg border border-gray-200 bg-white p-6">
            <h3 class="mb-3 text-xl font-bold">Tasks</h3>
            <ul class="list-inside list-disc space-y-2">
              {
                tasks.slice(0, 5).map((task) => (
                  <li>
                    <a href={`/docs/${task.id}`} class="text-blue-600 hover:underline">
                      {task.data.title}
                    </a>
                  </li>
                ))
              }
            </ul>
            <a href="/docs/tasks" class="mt-4 inline-block text-blue-600 hover:underline"
              >View all tasks →</a
            >
          </div>

          <div class="rounded-lg border border-gray-200 bg-white p-6">
            <h3 class="mb-3 text-xl font-bold">API</h3>
            <ul class="list-inside list-disc space-y-2">
              {
                api.slice(0, 5).map((apiDoc) => (
                  <li>
                    <a href={`/docs/${apiDoc.id}`} class="text-blue-600 hover:underline">
                      {apiDoc.data.title}
                    </a>
                  </li>
                ))
              }
            </ul>
            <a href="/docs/api" class="mt-4 inline-block text-blue-600 hover:underline"
              >View all API docs →</a
            >
          </div>
        </div>
      </div>
    </div>
  </div>
</Layout>
