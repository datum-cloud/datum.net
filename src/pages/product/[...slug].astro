---
import Layout from '@layouts/Layout.astro';
import { getEntry, render } from 'astro:content';

export const prerender = false;

const { slug } = Astro.params;
let page;
let Content;

try {
  // Use getEntry to fetch a single entry directly
  page = await getEntry('pages', `product/${slug}`);

  if (page) {
    const rendered = await render(page);
    Content = rendered.Content;
  } else {
    // Redirect to 404 if page not found
    return Astro.redirect('/404', 404);
  }
} catch (error) {
  console.error('Error loading product page:', error);
  return Astro.redirect('/404', 500);
}
---

<Layout title={page.data.title} description={page.data.description}>
  <main class="container mx-auto px-4 py-8">
    <article class="prose max-w-none">
      <Content />
    </article>
    <div class="mt-8 border-t pt-4">
      <a href="/features" class="text-blue-600 hover:text-blue-800">&larr; Back to Our Platform</a>
    </div>
  </main>
</Layout>
