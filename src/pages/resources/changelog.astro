---
import '@v1/styles/page-changelog.css';
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';

import Layout from '@layouts/Layout.astro';
import Hero from '@components/Hero.astro';
import Footer from '@components/Footer.astro';
import Card from '@components/changelog/Card.astro';
import OpenNetwork from '@components/GlobalSection.astro';
import ImageTwoPerson from '@v1/assets/images/two-person.png';

import { getCollectionEntry } from '@utils/collectionUtils';

const changelogEntries = await getCollection('changelog', ({ id }) => id !== 'index');
const page = await getCollectionEntry('changelog', 'index');

const sortedEntries = changelogEntries.sort((a, b) => {
  // const versionA = parseFloat(a.data.version ?? '0');
  // const versionB = parseFloat(b.data.version ?? '0');
  // return versionB - versionA;

  const dateA = a.data.date ? new Date(a.data.date).getTime() : 0;
  const dateB = b.data.date ? new Date(b.data.date).getTime() : 0;
  return dateB - dateA;
});

// SEO
const fm = page.data;
const meta = fm.meta || {};
const title = fm.title ? fm.title : 'Datum Changelog';
const description = fm.description ? fm.description : '';

const subtitle = fm.subtitle ? fm.subtitle : 'Changelog';
const icon = 'list-restart';
---

<Layout title={title} description={description} bodyClass="changelog-page" meta={meta}>
  <section class="datum-container">
    <Hero
      class="light"
      iconName={icon}
      title={title}
      description={fm.description}
      subtitle={subtitle}
    />

    <div class="section--block section--block--pad bg-midnight-fjord dark">
      <div class="changelog-container">
        {
          sortedEntries.map((item) => (
            <Card
              id={item.id}
              date={item.data.date ?? new Date()}
              title={item.data.title}
              description={item.body ?? ''}
              tags={item.data.tags}
            />
          ))
        }
      </div>

      <div class="absolute right-50 bottom-0 z-40 inline-block">
        <Image
          src={ImageTwoPerson}
          alt="Two Person"
          class="relative h-auto w-[179px]"
          data-scroll-effect="parallax"
          data-scroll-speed="0.1"
          data-scroll-direction="down"
          data-viewport-offset="-300"
          data-max-movement="50"
        />
      </div>
    </div>

    <OpenNetwork />

    <Footer />
  </section>
</Layout>
