---
import Logo from '@v1/assets/svgs/datum-logo.svg';
import Arrow from '@v1/assets/icons/arrow.svg';
import Burger from '@v1/assets/icons/burger.svg';
import navigation from '@data/navigation.json';
import Icon from '@v1/components/Icon.astro';
import MobileMenu from '@v1/components/MobileMenu.astro';
import type { NavData } from '../../types/navigation';

// Type-safe navigation data
const navData = navigation as NavData;
const mainNav = navData.main;
---

<nav class="nav--main">
  {/* Logo */}
  <a href="/" class="nav-logo">
    <Logo class="text-lime-green" />
  </a>

  {/* Desktop Menu */}
  <ul class="nav-menu">
    {
      mainNav.map((item) => (
        <li class={`nav-menu-item ${item.children ? 'nav-dropdown' : ''}`}>
          <a href={item.href} class="nav-menu-link">
            <span>{item.text}</span>
            {item.children && <Arrow class="nav-dropdown-arrow" />}
          </a>
          {item.children && (
            <ul class={`nav-dropdown-menu ${item.children.length > 1 ? 'nav-dropdown-mega' : ''}`}>
              {item.children.map((section) => (
                <li
                  class={`nav-dropdown-section ${item.children!.length > 1 ? 'nav-dropdown-mega-section' : ''}`}
                >
                  {'title' in section && section.title && (
                    <h3 class="nav-dropdown-title">{section.title}</h3>
                  )}
                  <ul
                    class={`nav-dropdown-items ${item.children!.length > 1 ? 'nav-dropdown-mega-items' : ''}`}
                  >
                    {section.items?.map((subItem) => (
                      <li class="nav-dropdown-item">
                        <a href={subItem.href} class="nav-dropdown-link">
                          {'icon' in subItem && subItem.icon && (
                            <div class="nav-dropdown-icon">
                              <Icon name={subItem.icon} size="md" />
                            </div>
                          )}
                          <span>{subItem.text}</span>
                        </a>
                      </li>
                    ))}
                  </ul>
                </li>
              ))}
            </ul>
          )}
        </li>
      ))
    }
  </ul>

  {/* Desktop Actions */}
  <div class="nav-actions">
    {/* 85.4k Button */}
    <a href="#" class="btn btn--primary">
      <div class="btn-icon">
        <Icon name="github" size="md" />
      </div>
      <span class="btn-text">85.4k</span>
    </a>

    {/* Log In Button */}
    <a href="#" class="btn btn--primary">
      <div class="btn-icon">
        <Icon name="user" size="md" />
      </div>
      <span class="btn-text">Log In</span>
    </a>
  </div>

  {/* Mobile Menu Button */}
  <button
    id="mobile-menu-button"
    class="mobile-menu-button"
    aria-label="Toggle mobile menu"
    aria-expanded="false"
  >
    <Burger />
  </button>

  {/* Mobile Menu Component */}
  <MobileMenu navigation={mainNav} />
</nav>
